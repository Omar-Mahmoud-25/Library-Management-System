@model CreateBookViewModel

@{
    ViewData["Title"] = "Add Book";
}

<style>
    .create-book-form {
        background-color: #1e1e1e;
        color: #fff;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 255, 136, 0.2);
    }

    .create-book-form .form-label {
        color: #ccc;
        font-weight: 500;
    }

    .create-book-form .form-control,
    .create-book-form .form-select,
    .create-book-form textarea {
        background-color: #2c2c2c;
        border: 1px solid #444;
        color: #fff;
    }

    .create-book-form .form-control::placeholder,
    .create-book-form textarea::placeholder {
        color: #888;
    }

    .create-book-form .form-text {
        color: #fff; 
        font-size: 0.9rem;
    }

    .create-book-form .btn-primary {
        background-color: #00ff88;
        border-color: #00ff88;
        color: #000;
    }

    .create-book-form .btn-primary:hover {
        background-color: #00cc6a;
        border-color: #00cc6a;
        color: #fff;
    }

    .cover-preview {
        border-radius: 10px;
        border: 1px solid #333;
    }
</style>

<h5 class="text-white">
    <i class="bi bi-plus-circle-dotted"></i>
    Add a new Book
</h5>

<div class="create-book-form">
    <form asp-controller="Book" asp-action="Create" method="post" enctype="multipart/form-data">
        <div class="row">
            <div class="col-md-6">

                <!-- Book Title -->
                <div class="form-group">
                    <label asp-for="Title" class="form-label mt-4"></label>
                    <input type="text" class="form-control" asp-for="Title" placeholder="Enter book title" />
                    <span asp-validation-for="Title" class="text-danger"></span>
                </div>

                <!-- Author -->
                <div class="form-group">
                    <label asp-for="Author" class="form-label mt-4"></label>
                    <input type="text" class="form-control" asp-for="Author" placeholder="Enter author name" />
                    <span asp-validation-for="Author" class="text-danger"></span>
                </div>

            <!-- Categories (Multiple Selection) -->
            <div class="form-group">
                <label asp-for="SelectedCategoryIds" class="form-label mt-4"></label>
                <select class="form-select" asp-for="SelectedCategoryIds" asp-items="Model.Categories" multiple>
                    <option disabled>Select one or more categories</option>
                </select>
                <small class="form-text text-muted">Hold Ctrl (Cmd on Mac) to select multiple categories</small>
                <span asp-validation-for="SelectedCategoryIds" class="text-danger"></span>
            </div>

            <!-- Published Date -->
            <div class="form-group">
                <label asp-for="PublishedDate" class="form-label mt-4"></label>
                <input type="date" class="form-control" asp-for="PublishedDate" />
                <span asp-validation-for="PublishedDate" class="text-danger"></span>
            </div>

            <!-- Copies Available -->
            <div class="form-group">
                <label asp-for="CopiesAvailable" class="form-label mt-4"></label>
                <input type="number" class="form-control" asp-for="CopiesAvailable" min="1" placeholder="Number of copies" />
                <span asp-validation-for="CopiesAvailable" class="text-danger"></span>
            </div>

            <!-- Description -->
            <div class="form-group">
                <label asp-for="Description" class="form-label mt-4"></label>
                <textarea asp-for="Description" class="form-control" rows="4" placeholder="Enter book description"></textarea>
                <span asp-validation-for="Description" class="text-danger"></span>
            </div>

            <!-- Cover Image -->
            <div class="form-group">
                <label asp-for="CoverImageUrl" class="form-label mt-4"></label>
                <input type="file" class="form-control" asp-for="CoverImageUrl" accept="image/*"
                       data-rule-extension=".jpg,.jpeg,.png,.gif,.webp"
                       data-msg-extension="Only image files allowed (JPG, PNG, GIF, WebP)"
                       data-rule-filesize="5242880"
                       data-msg-filesize="Max file size is 5 MB">
                <small class="form-text text-muted">Allowed: .jpg, .jpeg, .png, .gif, .webp (Max 5 MB)</small>
                <span asp-validation-for="CoverImageUrl" class="text-danger d-block"></span>
            </div>

            <!-- Submit -->
            <div class="form-group mt-4">
                <button type="submit" class="btn btn-primary me-2">
                    <i class="bi bi-save"></i> Save Book
                </button>
                <a asp-action="Index" class="btn btn-secondary">
                    <i class="bi bi-arrow-left"></i> Cancel
                </a>
            </div>
        </div>

        <!-- Preview -->
        <div class="col-md-6 d-flex flex-column justify-content-start pt-4">
            <h6 class="text-light mb-3">Book Preview</h6>
            <div class="card bg-dark border-light">
                <div class="card-body text-center">
                    <img class="cover-preview mb-3" src="/images/books/default-book-cover.jpg" 
                         alt="Cover Preview" style="max-height: 300px; border-radius: 8px;" />
                    <h5 class="book-title-preview text-light">Book Title</h5>
                    <p class="book-author-preview text-secondary">Author Name</p>
                    <div class="selected-categories-preview"></div>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        $(document).ready(function() {
            // Preview functionality
            function updatePreview() {
                const title = $('#Title').val() || 'Book Title';
                const author = $('#Author').val() || 'Author Name';
                
                $('.book-title-preview').text(title);
                $('.book-author-preview').text('by ' + author);
                
                // Update categories preview
                const selectedCategories = $('#SelectedCategoryIds option:selected');
                const categoriesHtml = selectedCategories.map(function() {
                    return '<span class="badge bg-info me-1">' + $(this).text() + '</span>';
                }).get().join('');
                $('.selected-categories-preview').html(categoriesHtml);
            }

            // Image preview
            $('#CoverImageUrl').on('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        $('.cover-preview').attr('src', e.target.result);
                    }
                    reader.readAsDataURL(file);
                }
            });

            // Update preview on input changes
            $('#Title, #Author, #SelectedCategoryIds').on('input change', updatePreview);
            
            // Initial preview update
            updatePreview();
        });
    </script>
}
